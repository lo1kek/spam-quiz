{% extends 'base.html' %}
{% block title %}Начало теста — Спам или не спам{% endblock %}
{% block content %}
<h1>Проверка номера: спам или нет?</h1>
<p>
  За 2024 год сервис "МТС Защитник" заблокировал более 2 млрд нежелательных звонков.
  Сервис построен на базе AI компонентов, которые в отличие от человека работают 24 часа в сутки и 365 дней в году.
</p>
<p>
  Дорогой коллега, сегодня мы хотим тебя попросить побыть нашей моделью которая принимает решение "заблокировать" номер или нет.
</p>
<p>
  Далее мы покажем тебе 10 карточек с звонковой активностью (красные полоски на графике, это звонки и их длительность) — анализируя
  сколько звонков и какова длительность, прими верное решение: заблокировать или пропустить звонок далее.
</p>
<p>Введите данные, чтобы начать тест.</p>
<form method="post" action="{{ url_for('start_quiz') }}">
  <div class="form-group">
    <label for="name">Имя</label>
    <input type="text" id="name" name="name" placeholder="Например, Анна" value="{{ request.form.get('name', '') }}" required />
  </div>
  <div class="form-group">
    <label for="phone">Телефон</label>
    <input
      type="tel"
      id="phone"
      name="phone"
      placeholder="+7 (916) 123-44-55"
      pattern="\+7\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}"
      maxlength="18"
      inputmode="numeric"
      value="{{ request.form.get('phone', '') }}"
      required
    />
  </div>
  {% if error %}
  <p style="color: #d9534f; font-weight: 600;">{{ error }}</p>
  {% endif %}
  <button type="submit">Начать</button>
</form>
{% block scripts %}
<script>
  (function () {
    const phoneInput = document.getElementById('phone');
    if (!phoneInput) {
      return;
    }

    const formatValue = (raw) => {
      let digits = raw.replace(/\D/g, '');
      if (!digits) {
        return '';
      }

      if (digits[0] === '8') {
        digits = '7' + digits.slice(1);
      } else if (digits[0] !== '7') {
        digits = '7' + digits;
      }

      digits = digits.slice(0, 11);

      const local = digits.slice(1);
      const part1 = local.slice(0, 3);
      const part2 = local.slice(3, 6);
      const part3 = local.slice(6, 8);
      const part4 = local.slice(8, 10);

      let formatted = '+7';
      if (part1) {
        formatted += ' (' + part1;
      }

      if (part1.length === 3) {
        formatted += ')';
      }

      if (part2) {
        formatted += ' ' + part2;
      }

      if (part3) {
        formatted += '-' + part3;
      }

      if (part4) {
        formatted += '-' + part4;
      }

      return formatted;
    };

    const handleInput = () => {
      const formatted = formatValue(phoneInput.value);
      phoneInput.value = formatted;
      if (document.activeElement === phoneInput) {
        phoneInput.setSelectionRange(formatted.length, formatted.length);
      }
    };

    phoneInput.addEventListener('input', handleInput);
    phoneInput.addEventListener('blur', handleInput);
    phoneInput.addEventListener('focus', handleInput);
    handleInput();
  })();
</script>
{% endblock %}
{% endblock %}
